{"version":3,"file":"BigPicture.js","sources":["../../src/BigPicture.js"],"sourcesContent":["// BigPicture.js | license MIT | henrygd.me/bigpicture\n\n// trigger element used to open popup\nlet el\n\n// set to true after first interaction\nlet initialized\n\n// container element holding html needed for script\nlet container\n\n// currently active display element (image, video, youtube / vimeo iframe container)\nlet displayElement\n\n// popup image element\nlet displayImage\n\n// popup video element\nlet displayVideo\n\n// popup audio element\nlet displayAudio\n\n// container element to hold youtube / vimeo iframe\nlet iframeContainer\n\n// iframe to hold youtube / vimeo player\nlet iframeSiteVid\n\n// store requested image source\nlet imgSrc\n\n// button that closes the container\nlet closeButton\n\n// youtube / vimeo video id\nlet siteVidID\n\n// keeps track of loading icon display state\nlet isLoading\n\n// timeout to check video status while loading\nlet checkMediaTimeout\n\n// loading icon element\nlet loadingIcon\n\n// caption element\nlet caption\n\n// caption content element\nlet captionText\n\n// store caption content\nlet captionContent\n\n// hide caption button element\nlet captionHideButton\n\n// open state for container element\nlet isOpen\n\n// gallery open state\nlet galleryOpen\n\n// used during close animation to avoid triggering timeout twice\nlet isClosing\n\n// array of prev viewed image urls to check if cached before showing loading icon\nconst imgCache = []\n\n// store whether image requested is remote or local\nlet remoteImage\n\n// store animation opening callbacks\nlet animationStart\nlet animationEnd\n\n// store changeGalleryImage callback\nlet onChangeImage\n\n// gallery left / right icons\nlet rightArrowBtn\n\nlet leftArrowBtn\n\n// position of gallery\nlet galleryPosition\n\n// hold active gallery els / image src\nlet galleryEls\n\n// counter element\nlet galleryCounter\n\n// store images in gallery that are being loaded\nlet preloadedImages = {}\n\n// whether device supports touch events\nlet supportsTouch\n\n// options object\nlet opts\n\n// Save bytes in the minified version\nconst appendEl = 'appendChild'\nconst createEl = 'createElement'\nconst removeEl = 'removeChild'\n\nexport default (options) => {\n\t// initialize called on initial open to create elements / style / event handlers\n\tinitialized || initialize()\n\n\t// clear currently loading stuff\n\tif (isLoading) {\n\t\tclearTimeout(checkMediaTimeout)\n\t\tremoveContainer()\n\t}\n\n\topts = options\n\n\t// store video id if youtube / vimeo video is requested\n\tsiteVidID = options.ytSrc || options.vimeoSrc\n\n\t// store optional callbacks\n\tanimationStart = options.animationStart\n\tanimationEnd = options.animationEnd\n\tonChangeImage = options.onChangeImage\n\n\t// set trigger element\n\tel = options.el\n\n\t// wipe existing remoteImage state\n\tremoteImage = false\n\n\t// set caption if provided\n\tcaptionContent = el.getAttribute('data-caption')\n\n\tif (options.gallery) {\n\t\tmakeGallery(options.gallery, options.position)\n\t} else if (siteVidID || options.iframeSrc) {\n\t\t// if vimeo, youtube, or iframe video\n\t\t// toggleLoadingIcon(true)\n\t\tdisplayElement = iframeContainer\n\t\tcreateIframe()\n\t} else if (options.imgSrc) {\n\t\t// if remote image\n\t\tremoteImage = true\n\t\timgSrc = options.imgSrc\n\t\t!~imgCache.indexOf(imgSrc) && toggleLoadingIcon(true)\n\t\tdisplayElement = displayImage\n\t\tdisplayElement.src = imgSrc\n\t} else if (options.audio) {\n\t\t// if direct video link\n\t\ttoggleLoadingIcon(true)\n\t\tdisplayElement = displayAudio\n\t\tdisplayElement.src = options.audio\n\t\tcheckMedia('audio file')\n\t} else if (options.vidSrc) {\n\t\t// if direct video link\n\t\ttoggleLoadingIcon(true)\n\t\tif (options.dimensions) {\n\t\t\tchangeCSS(displayVideo, `width:${options.dimensions[0]}px`)\n\t\t}\n\t\tmakeVidSrc(options.vidSrc)\n\t\tcheckMedia('video')\n\t} else {\n\t\t// local image / background image already loaded on page\n\t\tdisplayElement = displayImage\n\t\t// get img source or element background image\n\t\tdisplayElement.src =\n\t\t\tel.tagName === 'IMG'\n\t\t\t\t? el.src\n\t\t\t\t: window\n\t\t\t\t\t\t.getComputedStyle(el)\n\t\t\t\t\t\t.backgroundImage.replace(/^url|[(|)|'|\"]/g, '')\n\t}\n\n\t// add container to page\n\tcontainer[appendEl](displayElement)\n\tdocument.body[appendEl](container)\n\treturn {\n\t\tclose,\n\t\tnext: () => updateGallery(1),\n\t\tprev: () => updateGallery(-1),\n\t}\n}\n\n// create all needed methods / store dom elements on first use\nfunction initialize() {\n\tlet startX\n\t// return close button elements\n\tfunction createCloseButton(className) {\n\t\tconst el = document[createEl]('button')\n\t\tel.className = className\n\t\tel.innerHTML =\n\t\t\t'<svg viewBox=\"0 0 48 48\"><path d=\"M28 24L47 5a3 3 0 1 0-4-4L24 20 5 1a3 3 0 1 0-4 4l19 19L1 43a3 3 0 1 0 4 4l19-19 19 19a3 3 0 0 0 4 0v-4L28 24z\"/></svg>'\n\t\treturn el\n\t}\n\n\tfunction createArrowSymbol(direction, style) {\n\t\tconst el = document[createEl]('button')\n\t\tel.className = 'bp-lr'\n\t\tel.innerHTML =\n\t\t\t'<svg viewBox=\"0 0 129 129\" height=\"70\" fill=\"#fff\"><path d=\"M88.6 121.3c.8.8 1.8 1.2 2.9 1.2s2.1-.4 2.9-1.2a4.1 4.1 0 0 0 0-5.8l-51-51 51-51a4.1 4.1 0 0 0-5.8-5.8l-54 53.9a4.1 4.1 0 0 0 0 5.8l54 53.9z\"/></svg>'\n\t\tchangeCSS(el, style)\n\t\tel.onclick = (e) => {\n\t\t\te.stopPropagation()\n\t\t\tupdateGallery(direction)\n\t\t}\n\t\treturn el\n\t}\n\n\t// add style - if you want to tweak, run through beautifier\n\tconst style = document[createEl]('STYLE')\n\tstyle.innerHTML =\n\t\t'#bp_caption,#bp_container{bottom:0;left:0;right:0;position:fixed;opacity:0}#bp_container>*,#bp_loader{position:absolute;right:0;z-index:10}#bp_container,#bp_caption,#bp_container svg{pointer-events:none}#bp_container{top:0;z-index:9999;background:rgba(0,0,0,.7);opacity:0;transition:opacity .35s}#bp_loader{top:0;left:0;bottom:0;display:flex;align-items:center;cursor:wait;background:0;z-index:9}#bp_loader svg{width:50%;max-width:300px;max-height:50%;margin:auto;animation:bpturn 1s infinite linear}#bp_aud,#bp_container img,#bp_sv,#bp_vid{user-select:none;max-height:96%;max-width:96%;top:0;bottom:0;left:0;margin:auto;box-shadow:0 0 3em rgba(0,0,0,.4);z-index:-1}#bp_sv{background:#111}#bp_sv svg{width:66px}#bp_caption{font-size:.9em;padding:1.3em;background:rgba(15,15,15,.94);color:#fff;text-align:center;transition:opacity .3s}#bp_aud{width:650px;top:calc(50% - 20px);bottom:auto;box-shadow:none}#bp_count{left:0;right:auto;padding:14px;color:rgba(255,255,255,.7);font-size:22px;cursor:default}#bp_container button{position:absolute;border:0;outline:0;background:0;cursor:pointer;transition:all .1s}#bp_container>.bp-x{padding:0;height:41px;width:41px;border-radius:100%;top:8px;right:14px;opacity:.8;line-height:1}#bp_container>.bp-x:focus,#bp_container>.bp-x:hover{background:rgba(255,255,255,.2)}.bp-x svg,.bp-xc svg{height:21px;width:20px;fill:#fff;vertical-align:top;}.bp-xc svg{width:16px}#bp_container .bp-xc{left:2%;bottom:100%;padding:9px 20px 7px;background:#d04444;border-radius:2px 2px 0 0;opacity:.85}#bp_container .bp-xc:focus,#bp_container .bp-xc:hover{opacity:1}.bp-lr{top:50%;top:calc(50% - 130px);padding:99px 0;width:6%;background:0;border:0;opacity:.4;transition:opacity .1s}.bp-lr:focus,.bp-lr:hover{opacity:.8}@keyframes bpf{50%{transform:translatex(15px)}100%{transform:none}}@keyframes bpl{50%{transform:translatex(-15px)}100%{transform:none}}@keyframes bpfl{0%{opacity:0;transform:translatex(70px)}100%{opacity:1;transform:none}}@keyframes bpfr{0%{opacity:0;transform:translatex(-70px)}100%{opacity:1;transform:none}}@keyframes bpfol{0%{opacity:1;transform:none}100%{opacity:0;transform:translatex(-70px)}}@keyframes bpfor{0%{opacity:1;transform:none}100%{opacity:0;transform:translatex(70px)}}@keyframes bpturn{0%{transform:none}100%{transform:rotate(360deg)}}@media (max-width:600px){.bp-lr{font-size:15vw}}'\n\tdocument.head[appendEl](style)\n\n\t// create container element\n\tcontainer = document[createEl]('DIV')\n\tcontainer.id = 'bp_container'\n\tcontainer.onclick = close\n\tcloseButton = createCloseButton('bp-x')\n\tcontainer[appendEl](closeButton)\n\t// gallery swipe listeners\n\tif ('ontouchstart' in window) {\n\t\tsupportsTouch = true\n\t\tcontainer.ontouchstart = ({ changedTouches }) => {\n\t\t\tstartX = changedTouches[0].pageX\n\t\t}\n\t\tcontainer.ontouchmove = (e) => {\n\t\t\te.preventDefault()\n\t\t}\n\t\tcontainer.ontouchend = ({ changedTouches }) => {\n\t\t\tif (!galleryOpen) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst distX = changedTouches[0].pageX - startX\n\t\t\t// swipe right\n\t\t\tdistX < -30 && updateGallery(1)\n\t\t\t// swipe left\n\t\t\tdistX > 30 && updateGallery(-1)\n\t\t}\n\t}\n\n\t// create display image element\n\tdisplayImage = document[createEl]('IMG')\n\n\t// create display video element\n\tdisplayVideo = document[createEl]('VIDEO')\n\tdisplayVideo.id = 'bp_vid'\n\tdisplayVideo.setAttribute('playsinline', true)\n\tdisplayVideo.controls = true\n\tdisplayVideo.loop = true\n\n\t// create audio element\n\tdisplayAudio = document[createEl]('audio')\n\tdisplayAudio.id = 'bp_aud'\n\tdisplayAudio.controls = true\n\tdisplayAudio.loop = true\n\n\t// create gallery counter\n\tgalleryCounter = document[createEl]('span')\n\tgalleryCounter.id = 'bp_count'\n\n\t// create caption elements\n\tcaption = document[createEl]('DIV')\n\tcaption.id = 'bp_caption'\n\tcaptionHideButton = createCloseButton('bp-xc')\n\tcaptionHideButton.onclick = toggleCaption.bind(null, false)\n\tcaption[appendEl](captionHideButton)\n\tcaptionText = document[createEl]('SPAN')\n\tcaption[appendEl](captionText)\n\tcontainer[appendEl](caption)\n\n\t// left / right arrow icons\n\trightArrowBtn = createArrowSymbol(1, 'transform:scalex(-1)')\n\tleftArrowBtn = createArrowSymbol(-1, 'left:0;right:auto')\n\n\t// create loading icon element\n\tloadingIcon = document[createEl]('DIV')\n\tloadingIcon.id = 'bp_loader'\n\tloadingIcon.innerHTML =\n\t\t'<svg viewbox=\"0 0 32 32\" fill=\"#fff\" opacity=\".8\"><path d=\"M16 0a16 16 0 0 0 0 32 16 16 0 0 0 0-32m0 4a12 12 0 0 1 0 24 12 12 0 0 1 0-24\" fill=\"#000\" opacity=\".5\"/><path d=\"M16 0a16 16 0 0 1 16 16h-4A12 12 0 0 0 16 4z\"/></svg>'\n\t// create youtube / vimeo container\n\tiframeContainer = document[createEl]('DIV')\n\tiframeContainer.id = 'bp_sv'\n\n\t// create iframe to hold youtube / vimeo player\n\tiframeSiteVid = document[createEl]('IFRAME')\n\tiframeSiteVid.setAttribute('allowfullscreen', true)\n\tiframeSiteVid.allow = 'autoplay; fullscreen'\n\tiframeSiteVid.onload = () => iframeContainer[removeEl](loadingIcon)\n\tchangeCSS(\n\t\tiframeSiteVid,\n\t\t'border:0;position:absolute;height:100%;width:100%;left:0;top:0'\n\t)\n\tiframeContainer[appendEl](iframeSiteVid)\n\n\t// display image bindings for image load and error\n\tdisplayImage.onload = open\n\tdisplayImage.onerror = open.bind(null, 'image')\n\n\twindow.addEventListener('resize', () => {\n\t\t// adjust loader position on window resize\n\t\tgalleryOpen || (isLoading && toggleLoadingIcon(true))\n\t\t// adjust iframe dimensions\n\t\tdisplayElement === iframeContainer && updateIframeDimensions()\n\t})\n\n\t// close container on escape key press and arrow buttons for gallery\n\tdocument.addEventListener('keyup', ({ keyCode }) => {\n\t\tkeyCode === 27 && isOpen && close()\n\t\tif (galleryOpen) {\n\t\t\tkeyCode === 39 && updateGallery(1)\n\t\t\tkeyCode === 37 && updateGallery(-1)\n\t\t\tkeyCode === 38 && updateGallery(10)\n\t\t\tkeyCode === 40 && updateGallery(-10)\n\t\t}\n\t})\n\t// prevent scrolling with arrow keys if gallery open\n\tdocument.addEventListener('keydown', (e) => {\n\t\tconst usedKeys = [37, 38, 39, 40]\n\t\tif (galleryOpen && ~usedKeys.indexOf(e.keyCode)) {\n\t\t\te.preventDefault()\n\t\t}\n\t})\n\n\t// trap focus within conainer while open\n\tdocument.addEventListener(\n\t\t'focus',\n\t\t(e) => {\n\t\t\tif (isOpen && !container.contains(e.target)) {\n\t\t\t\te.stopPropagation()\n\t\t\t\tcloseButton.focus()\n\t\t\t}\n\t\t},\n\t\ttrue\n\t)\n\n\t// all done\n\tinitialized = true\n}\n\n// return transform style to make full size display el match trigger el size\nfunction getRect() {\n\tconst { top, left, width, height } = el.getBoundingClientRect()\n\tconst leftOffset = left - (container.clientWidth - width) / 2\n\tconst centerTop = top - (container.clientHeight - height) / 2\n\tconst scaleWidth = el.clientWidth / displayElement.clientWidth\n\tconst scaleHeight = el.clientHeight / displayElement.clientHeight\n\treturn `transform:translate3D(${leftOffset}px, ${centerTop}px, 0) scale3D(${scaleWidth}, ${scaleHeight}, 0)`\n}\n\nfunction makeVidSrc(source) {\n\tif (Array.isArray(source)) {\n\t\tdisplayElement = displayVideo.cloneNode()\n\t\tsource.forEach((src) => {\n\t\t\tconst source = document[createEl]('SOURCE')\n\t\t\tsource.src = src\n\t\t\tsource.type = `video/${src.match(/.(\\w+)$/)[1]}`\n\t\t\tdisplayElement[appendEl](source)\n\t\t})\n\t} else {\n\t\tdisplayElement = displayVideo\n\t\tdisplayElement.src = source\n\t}\n}\n\nfunction makeGallery(gallery, position) {\n\tlet galleryAttribute = opts.galleryAttribute || 'data-bp'\n\tif (Array.isArray(gallery)) {\n\t\t// is array of images\n\t\tgalleryPosition = position || 0\n\t\tgalleryEls = gallery\n\t\tcaptionContent = gallery[galleryPosition].caption\n\t} else {\n\t\t// is element selector or nodelist\n\t\tgalleryEls = [].slice.call(\n\t\t\ttypeof gallery === 'string'\n\t\t\t\t? document.querySelectorAll(`${gallery} [${galleryAttribute}]`)\n\t\t\t\t: gallery\n\t\t)\n\t\t// find initial gallery position\n\t\tconst elIndex = galleryEls.indexOf(el)\n\t\tgalleryPosition =\n\t\t\tposition === 0 || position ? position : elIndex !== -1 ? elIndex : 0\n\t\t// make gallery object w/ els / src / caption\n\t\tgalleryEls = galleryEls.map((el) => ({\n\t\t\tel,\n\t\t\tsrc: el.getAttribute(galleryAttribute),\n\t\t\tcaption: el.getAttribute('data-caption'),\n\t\t}))\n\t}\n\t// show loading icon if needed\n\tremoteImage = true\n\t// set initial src to imgSrc so it will be cached in open func\n\timgSrc = galleryEls[galleryPosition].src\n\t!~imgCache.indexOf(imgSrc) && toggleLoadingIcon(true)\n\tif (galleryEls.length > 1) {\n\t\t// if length is greater than one, add gallery stuff\n\t\tcontainer[appendEl](galleryCounter)\n\t\tgalleryCounter.innerHTML = `${galleryPosition + 1}/${galleryEls.length}`\n\t\tif (!supportsTouch) {\n\t\t\t// add arrows if device doesn't support touch\n\t\t\tcontainer[appendEl](rightArrowBtn)\n\t\t\tcontainer[appendEl](leftArrowBtn)\n\t\t}\n\t} else {\n\t\t// gallery is one, just show without clutter\n\t\tgalleryEls = false\n\t}\n\tdisplayElement = displayImage\n\t// set initial image src\n\tdisplayElement.src = imgSrc\n}\n\nfunction updateGallery(movement) {\n\tconst galleryLength = galleryEls.length - 1\n\n\t// only allow one change at a time\n\tif (isLoading) {\n\t\treturn\n\t}\n\n\t// return if requesting out of range image\n\tconst isEnd =\n\t\t(movement > 0 && galleryPosition === galleryLength) ||\n\t\t(movement < 0 && !galleryPosition)\n\tif (isEnd) {\n\t\t// if beginning or end of gallery, run end animation\n\t\tif (!opts.loop) {\n\t\t\tchangeCSS(displayImage, '')\n\t\t\tsetTimeout(\n\t\t\t\tchangeCSS,\n\t\t\t\t9,\n\t\t\t\tdisplayImage,\n\t\t\t\t`animation:${\n\t\t\t\t\tmovement > 0 ? 'bpl' : 'bpf'\n\t\t\t\t} .3s;transition:transform .35s`\n\t\t\t)\n\t\t\treturn\n\t\t}\n\t\t// if gallery is looped, adjust position to beginning / end\n\t\tgalleryPosition = movement > 0 ? -1 : galleryLength + 1\n\t}\n\n\t// normalize position\n\tgalleryPosition = Math.max(\n\t\t0,\n\t\tMath.min(galleryPosition + movement, galleryLength)\n\t)\n\n\t// load images before and after for quicker scrolling through pictures\n\t;[galleryPosition - 1, galleryPosition, galleryPosition + 1].forEach(\n\t\t(position) => {\n\t\t\t// normalize position\n\t\t\tposition = Math.max(0, Math.min(position, galleryLength))\n\t\t\t// cancel if image has already been preloaded\n\t\t\tif (preloadedImages[position]) return\n\t\t\tconst src = galleryEls[position].src\n\t\t\t// create image for preloadedImages\n\t\t\tconst img = document[createEl]('IMG')\n\t\t\timg.addEventListener('load', addToImgCache.bind(null, src))\n\t\t\timg.src = src\n\t\t\tpreloadedImages[position] = img\n\t\t}\n\t)\n\t// if image is loaded, show it\n\tif (preloadedImages[galleryPosition].complete) {\n\t\treturn changeGalleryImage(movement)\n\t}\n\t// if not, show loading icon and change when loaded\n\tisLoading = true\n\tchangeCSS(loadingIcon, 'opacity:.4;')\n\tcontainer[appendEl](loadingIcon)\n\tpreloadedImages[galleryPosition].onload = () => {\n\t\tgalleryOpen && changeGalleryImage(movement)\n\t}\n\t// if error, store error object in el array\n\tpreloadedImages[galleryPosition].onerror = () => {\n\t\tgalleryEls[galleryPosition] = {\n\t\t\terror: 'Error loading image',\n\t\t}\n\t\tgalleryOpen && changeGalleryImage(movement)\n\t}\n}\n\nfunction changeGalleryImage(movement) {\n\tif (isLoading) {\n\t\tcontainer[removeEl](loadingIcon)\n\t\tisLoading = false\n\t}\n\tconst activeEl = galleryEls[galleryPosition]\n\tif (activeEl.error) {\n\t\t// show alert if error\n\t\talert(activeEl.error)\n\t} else {\n\t\t// add new image, animate images in and out w/ css animation\n\t\tconst oldimg = container.querySelector('img:last-of-type')\n\t\tdisplayImage = displayElement = preloadedImages[galleryPosition]\n\t\tchangeCSS(\n\t\t\tdisplayImage,\n\t\t\t`animation:${\n\t\t\t\tmovement > 0 ? 'bpfl' : 'bpfr'\n\t\t\t} .35s;transition:transform .35s`\n\t\t)\n\t\tchangeCSS(oldimg, `animation:${movement > 0 ? 'bpfol' : 'bpfor'} .35s both`)\n\t\tcontainer[appendEl](displayImage)\n\t\t// update el for closing animation\n\t\tif (activeEl.el) {\n\t\t\tel = activeEl.el\n\t\t}\n\t}\n\t// update counter\n\tgalleryCounter.innerHTML = `${galleryPosition + 1}/${galleryEls.length}`\n\t// show / hide caption\n\ttoggleCaption(galleryEls[galleryPosition].caption)\n\t// execute onChangeImage callback\n\tonChangeImage && onChangeImage([displayImage, galleryEls[galleryPosition]])\n}\n\n// create video iframe\nfunction createIframe() {\n\tlet url\n\tconst prefix = 'https://'\n\tconst suffix = 'autoplay=1'\n\n\t// create appropriate url\n\tif (opts.ytSrc) {\n\t\turl = `${prefix}www.youtube${\n\t\t\topts.ytNoCookie ? '-nocookie' : ''\n\t\t}.com/embed/${siteVidID}?html5=1&rel=0&playsinline=1&${suffix}`\n\t} else if (opts.vimeoSrc) {\n\t\turl = `${prefix}player.vimeo.com/video/${siteVidID}?${suffix}`\n\t} else if (opts.iframeSrc) {\n\t\turl = opts.iframeSrc\n\t}\n\n\t// add loading spinner to iframe container\n\tchangeCSS(loadingIcon, '')\n\tiframeContainer[appendEl](loadingIcon)\n\n\t// set iframe src to url\n\tiframeSiteVid.src = url\n\n\tupdateIframeDimensions()\n\n\tsetTimeout(open, 9)\n}\n\nfunction updateIframeDimensions() {\n\tlet height\n\tlet width\n\n\t// handle height / width / aspect / max width for iframe\n\tconst windowHeight = window.innerHeight * 0.95\n\tconst windowWidth = window.innerWidth * 0.95\n\tconst windowAspect = windowHeight / windowWidth\n\n\tconst [dimensionWidth, dimensionHeight] = opts.dimensions || [1920, 1080]\n\n\tconst iframeAspect = dimensionHeight / dimensionWidth\n\n\tif (iframeAspect > windowAspect) {\n\t\theight = Math.min(dimensionHeight, windowHeight)\n\t\twidth = height / iframeAspect\n\t} else {\n\t\twidth = Math.min(dimensionWidth, windowWidth)\n\t\theight = width * iframeAspect\n\t}\n\n\tiframeContainer.style.cssText += `width:${width}px;height:${height}px;`\n}\n\n// timeout to check video status while loading\nfunction checkMedia(errMsg) {\n\tif (~[1, 4].indexOf(displayElement.readyState)) {\n\t\topen()\n\t\t// short timeout to to make sure controls show in safari 11\n\t\tsetTimeout(() => {\n\t\t\tdisplayElement.play()\n\t\t}, 99)\n\t} else if (displayElement.error) {\n\t\topen(errMsg)\n\t} else {\n\t\tcheckMediaTimeout = setTimeout(checkMedia, 35, errMsg)\n\t}\n}\n\n// hide / show loading icon\nfunction toggleLoadingIcon(bool) {\n\t// don't show loading icon if noLoader is specified\n\tif (opts.noLoader) {\n\t\treturn\n\t}\n\t// bool is true if we want to show icon, false if we want to remove\n\t// change style to match trigger element dimensions if we want to show\n\tbool &&\n\t\tchangeCSS(\n\t\t\tloadingIcon,\n\t\t\t`top:${el.offsetTop}px;left:${el.offsetLeft}px;height:${el.clientHeight}px;width:${el.clientWidth}px`\n\t\t)\n\t// add or remove loader from DOM\n\tel.parentElement[bool ? appendEl : removeEl](loadingIcon)\n\tisLoading = bool\n}\n\n// hide & show caption\nfunction toggleCaption(captionContent) {\n\tif (captionContent) {\n\t\tcaptionText.innerHTML = captionContent\n\t}\n\tchangeCSS(\n\t\tcaption,\n\t\t`opacity:${captionContent ? `1;pointer-events:auto` : '0'}`\n\t)\n}\n\nfunction addToImgCache(url) {\n\t!~imgCache.indexOf(url) && imgCache.push(url)\n}\n\n// animate open of image / video; display caption if needed\nfunction open(err) {\n\t// hide loading spinner\n\tisLoading && toggleLoadingIcon()\n\n\t// execute animationStart callback\n\tanimationStart && animationStart()\n\n\t// check if we have an error string instead of normal event\n\tif (typeof err === 'string') {\n\t\tremoveContainer()\n\t\treturn opts.onError\n\t\t\t? opts.onError()\n\t\t\t: alert(`Error: The requested ${err} could not be loaded.`)\n\t}\n\n\t// if remote image is loaded, add url to imgCache array\n\tremoteImage && addToImgCache(imgSrc)\n\n\t// transform displayEl to match trigger el\n\tdisplayElement.style.cssText += getRect()\n\n\t// fade in container\n\tchangeCSS(container, `opacity:1;pointer-events:auto`)\n\n\t// set animationEnd callback to run after animation ends (cleared if container closed)\n\tanimationEnd = setTimeout(animationEnd, 410)\n\n\tisOpen = true\n\n\tgalleryOpen = !!galleryEls\n\n\t// enlarge displayEl, fade in caption if hasCaption\n\tsetTimeout(() => {\n\t\tdisplayElement.style.cssText += 'transition:transform .35s;transform:none'\n\t\tcaptionContent && setTimeout(toggleCaption, 250, captionContent)\n\t}, 60)\n}\n\n// close active display element\nfunction close(e) {\n\tconst target = e ? e.target : container\n\tconst clickEls = [\n\t\tcaption,\n\t\tcaptionHideButton,\n\t\tdisplayVideo,\n\t\tdisplayAudio,\n\t\tcaptionText,\n\t\tleftArrowBtn,\n\t\trightArrowBtn,\n\t\tloadingIcon,\n\t]\n\n\t// blur to hide close button focus style\n\ttarget.blur()\n\n\t// don't close if one of the clickEls was clicked or container is already closing\n\tif (isClosing || ~clickEls.indexOf(target)) {\n\t\treturn\n\t}\n\n\t// animate closing\n\tdisplayElement.style.cssText += getRect()\n\tchangeCSS(container, 'pointer-events:auto')\n\n\t// timeout to remove els from dom; use variable to avoid calling more than once\n\tsetTimeout(removeContainer, 350)\n\n\t// clear animationEnd timeout\n\tclearTimeout(animationEnd)\n\n\tisOpen = false\n\tisClosing = true\n}\n\n// remove container / display element from the DOM\nfunction removeContainer() {\n\t// clear src of displayElement (or iframe if display el is iframe container)\n\t// needs to be done before removing container in IE\n\tlet srcEl =\n\t\tdisplayElement === iframeContainer ? iframeSiteVid : displayElement\n\tsrcEl.removeAttribute('src')\n\n\t// remove container from DOM & clear inline style\n\tdocument.body[removeEl](container)\n\tcontainer[removeEl](displayElement)\n\tchangeCSS(container, '')\n\tchangeCSS(displayElement, '')\n\n\t// remove caption\n\ttoggleCaption(false)\n\n\tif (galleryOpen) {\n\t\t// remove all gallery stuff\n\t\tconst images = container.querySelectorAll('img')\n\t\tfor (let i = 0; i < images.length; i++) {\n\t\t\tcontainer[removeEl](images[i])\n\t\t}\n\t\tisLoading && container[removeEl](loadingIcon)\n\t\tcontainer[removeEl](galleryCounter)\n\t\tgalleryOpen = galleryEls = false\n\t\tpreloadedImages = {}\n\t\tsupportsTouch || container[removeEl](rightArrowBtn)\n\t\tsupportsTouch || container[removeEl](leftArrowBtn)\n\t\t// in case displayimage changed, we need to update event listeners\n\t\tdisplayImage.onload = open\n\t\tdisplayImage.onerror = open.bind(null, 'image')\n\t}\n\n\t// run close callback\n\topts.onClose && opts.onClose()\n\n\tisClosing = isLoading = false\n}\n\n// style helper functions\nfunction changeCSS({ style }, newStyle) {\n\tstyle.cssText = newStyle\n}\n"],"names":["let","el","initialized","container","displayElement","displayImage","displayVideo","displayAudio","iframeContainer","iframeSiteVid","imgSrc","closeButton","siteVidID","isLoading","checkMediaTimeout","loadingIcon","caption","captionText","captionContent","captionHideButton","isOpen","galleryOpen","isClosing","remoteImage","animationStart","animationEnd","onChangeImage","rightArrowBtn","leftArrowBtn","galleryPosition","galleryEls","galleryCounter","supportsTouch","opts","imgCache","preloadedImages","appendEl","createEl","removeEl","getRect","getBoundingClientRect","clientWidth","clientHeight","updateGallery","movement","const","galleryLength","length","loop","changeCSS","setTimeout","Math","max","min","forEach","position","src","img","document","addEventListener","addToImgCache","bind","complete","changeGalleryImage","onload","onerror","error","activeEl","alert","oldimg","querySelector","innerHTML","toggleCaption","updateIframeDimensions","height","width","windowHeight","window","innerHeight","windowWidth","innerWidth","dimensions","iframeAspect","dimensionHeight","dimensionWidth","style","cssText","checkMedia","errMsg","indexOf","readyState","open","play","toggleLoadingIcon","bool","noLoader","parentElement","url","push","err","removeContainer","onError","close","e","target","clickEls","blur","clearTimeout","removeAttribute","body","images","querySelectorAll","i","onClose","newStyle","options","source","startX","createCloseButton","className","createArrowSymbol","direction","onclick","stopPropagation","head","id","ontouchstart","changedTouches","pageX","ontouchmove","preventDefault","ontouchend","distX","setAttribute","controls","allow","keyCode","contains","focus","initialize","ytSrc","vimeoSrc","getAttribute","gallery","galleryAttribute","Array","isArray","elIndex","slice","call","map","makeGallery","iframeSrc","prefix","ytNoCookie","audio","vidSrc","cloneNode","type","match","tagName","getComputedStyle","backgroundImage","replace","next","prev"],"mappings":"0BAGAA,IAAIC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAGAC,EAMAC,EAGAC,EACAC,EAGAC,EAGAC,EAEAC,EAGAC,EAGAC,EAGAC,EAMAC,EAGAC,EAjCEC,EAAW,GA2BbC,EAAkB,GAShBC,EAAW,cACXC,EAAW,gBACXC,EAAW,cA+OjB,SAASC,UAC6BtC,EAAGuC,wBAKxC,wCAJ2BrC,EAAUsC,qBAAuB,kBACnCtC,EAAUuC,uBAAyB,qBACzCzC,EAAGwC,YAAcrC,EAAeqC,iBAC/BxC,EAAGyC,aAAetC,EAAesC,oBAmEtD,SAASC,EAAcC,GACtBC,IAAMC,EAAgBhB,EAAWiB,OAAS,EAG1C,IAAIlC,EAAJ,CAQA,GAFE+B,EAAW,GAAKf,IAAoBiB,GACpCF,EAAW,IAAMf,EACR,CAEV,IAAKI,EAAKe,KAUT,OATAC,EAAU5C,EAAc,SACxB6C,WACCD,EACA,EACA5C,gBAECuC,EAAW,EAAI,MAAQ,yCAM1Bf,EAAkBe,EAAW,GAAK,EAAIE,EAAgB,EAyBvD,GAfC,EANDjB,EAAkBsB,KAAKC,IACtB,EACAD,KAAKE,IAAIxB,EAAkBe,EAAUE,KAIlB,EAAGjB,EAAiBA,EAAkB,GAAGyB,iBAC3DC,GAIA,GAFAA,EAAWJ,KAAKC,IAAI,EAAGD,KAAKE,IAAIE,EAAUT,KAEtCX,EAAgBoB,GAApB,CACAV,IAAMW,EAAM1B,EAAWyB,GAAUC,IAE3BC,EAAMC,SAASrB,GAAU,OAC/BoB,EAAIE,iBAAiB,OAAQC,EAAcC,KAAK,KAAML,IACtDC,EAAID,IAAMA,EACVrB,EAAgBoB,GAAYE,KAI1BtB,EAAgBN,GAAiBiC,SACpC,OAAOC,EAAmBnB,GAG3B/B,EAAY,EACZoC,EAAUlC,EAAa,eACvBZ,EAAUiC,GAAUrB,GACpBoB,EAAgBN,GAAiBmC,kBAChC3C,GAAe0C,EAAmBnB,IAGnCT,EAAgBN,GAAiBoC,mBAChCnC,EAAWD,GAAmB,CAC7BqC,MAAO,uBAER7C,GAAe0C,EAAmBnB,KAIpC,SAASmB,EAAmBnB,GACvB/B,IACHV,EAAUmC,GAAUvB,GACpBF,EAAY,GAEbgC,IAAMsB,EAAWrC,EAAWD,GAC5B,GAAIsC,EAASD,MAEZE,MAAMD,EAASD,WACT,CAENrB,IAAMwB,EAASlE,EAAUmE,cAAc,oBAEvCrB,EADA5C,EAAeD,EAAiB+B,EAAgBN,iBAI9Ce,EAAW,EAAI,OAAS,2CAG1BK,EAAUoB,gBAAqBzB,EAAW,EAAI,QAAU,uBACxDzC,EAAUiC,GAAU/B,GAEhB8D,EAASlE,KACZA,EAAKkE,EAASlE,IAIhB8B,EAAewC,UAAe1C,EAAkB,MAAKC,SAErD0C,EAAc1C,EAAWD,GAAiBb,SAE1CU,GAAiBA,EAAc,CAACrB,EAAcyB,EAAWD,KAgC1D,SAAS4C,IACRzE,IAAI0E,EACAC,EAGEC,EAAoC,IAArBC,OAAOC,YACtBC,EAAkC,IAApBF,OAAOG,aAGe/C,EAAKgD,YAAc,CAAC,KAAM,oBAE9DC,EAAeC,EAAkBC,EAEnCF,EANiBN,EAAeG,EAQnCJ,GADAD,EAASvB,KAAKE,IAAI8B,EAAiBP,IAClBM,EAGjBR,GADAC,EAAQxB,KAAKE,IAAI+B,EAAgBL,IAChBG,EAGlB1E,EAAgB6E,MAAMC,SAAW,SAASX,eAAkBD,QAI7D,SAASa,EAAWC,IACd,CAAC,EAAG,GAAGC,QAAQrF,EAAesF,aAClCC,IAEAzC,sBACC9C,EAAewF,QACb,KACOxF,EAAe8D,MACzByB,EAAKH,GAEL1E,EAAoBoC,WAAWqC,EAAY,GAAIC,GAKjD,SAASK,EAAkBC,GAEtB7D,EAAK8D,WAKTD,GACC7C,EACClC,SACOd,uBAAuBA,0BAA0BA,2BAA2BA,oBAGrFA,EAAG+F,cAAcF,EAAO1D,EAAWE,GAAUvB,GAC7CF,EAAYiF,GAIb,SAAStB,EAActD,GAClBA,IACHD,EAAYsD,UAAYrD,GAEzB+B,EACCjC,cACWE,EAAiB,wBAA0B,MAIxD,SAAS0C,EAAcqC,KACpB/D,EAASuD,QAAQQ,IAAQ/D,EAASgE,KAAKD,GAI1C,SAASN,EAAKQ,GAQb,GANAtF,GAAagF,IAGbrE,GAAkBA,IAGC,iBAAR2E,EAEV,OADAC,IACOnE,EAAKoE,QACTpE,EAAKoE,UACLjC,8BAA8B+B,2BAIlC5E,GAAeqC,EAAclD,GAG7BN,EAAeiF,MAAMC,SAAW/C,IAGhCU,EAAU9C,EAAW,iCAGrBsB,EAAeyB,WAAWzB,EAAc,KAExCL,EAAS,EAETC,IAAgBS,EAGhBoB,sBACC9C,EAAeiF,MAAMC,SAAW,2CAChCpE,GAAkBgC,WAAWsB,EAAe,IAAKtD,IAC/C,IAIJ,SAASoF,EAAMC,GACd1D,IAAM2D,EAASD,EAAIA,EAAEC,OAASrG,EACxBsG,EAAW,CAChBzF,EACAG,EACAb,EACAC,EACAU,EACAW,EACAD,EACAZ,GAIDyF,EAAOE,OAGHpF,IAAcmF,EAAShB,QAAQe,KAKnCpG,EAAeiF,MAAMC,SAAW/C,IAChCU,EAAU9C,EAAW,uBAGrB+C,WAAWkD,EAAiB,KAG5BO,aAAalF,GAEbL,EAAS,EACTE,EAAY,GAIb,SAAS8E,IAgBR,IAZChG,IAAmBI,EAAkBC,EAAgBL,GAChDwG,gBAAgB,OAGtBlD,SAASmD,KAAKvE,GAAUnC,GACxBA,EAAUmC,GAAUlC,GACpB6C,EAAU9C,EAAW,IACrB8C,EAAU7C,EAAgB,IAG1BoE,EAAc,GAEVnD,EAAa,CAGhB,IADAwB,IAAMiE,EAAS3G,EAAU4G,iBAAiB,OACjCC,EAAI,EAAGA,EAAIF,EAAO/D,OAAQiE,IAClC7G,EAAUmC,GAAUwE,EAAOE,IAE5BnG,GAAaV,EAAUmC,GAAUvB,GACjCZ,EAAUmC,GAAUP,GACpBV,EAAcS,EAAa,EAC3BK,EAAkB,GAClBH,GAAiB7B,EAAUmC,GAAUX,GACrCK,GAAiB7B,EAAUmC,GAAUV,GAErCvB,EAAa2D,OAAS2B,EACtBtF,EAAa4D,QAAU0B,EAAK9B,KAAK,KAAM,SAIxC5B,EAAKgF,SAAWhF,EAAKgF,UAErB3F,EAAYT,EAAY,EAIzB,SAASoC,IAAqBiE,WACvB5B,QAAU4B,kBAxnBDC,GAsPhB,IAAoBC,EA9KnB,OAtEAlH,GA8ED,WACCF,IAAIqH,EAEJ,SAASC,EAAkBC,GAC1B1E,IAAM5C,EAAKyD,SAASrB,GAAU,UAI9B,OAHApC,EAAGsH,UAAYA,EACftH,EAAGsE,UACF,4JACMtE,EAGR,SAASuH,EAAkBC,EAAWpC,GACrCxC,IAAM5C,EAAKyD,SAASrB,GAAU,UAS9B,OARApC,EAAGsH,UAAY,QACftH,EAAGsE,UACF,oNACDtB,EAAUhD,EAAIoF,GACdpF,EAAGyH,iBAAWnB,GACbA,EAAEoB,kBACFhF,EAAc8E,IAERxH,EAIR4C,IAAMwC,EAAQ3B,SAASrB,GAAU,SACjCgD,EAAMd,UACL,wyEACDb,SAASkE,KAAKxF,GAAUiD,IAGxBlF,EAAYuD,SAASrB,GAAU,QACrBwF,GAAK,eACf1H,EAAUuH,QAAUpB,EACpB3F,EAAc2G,EAAkB,QAChCnH,EAAUiC,GAAUzB,GAEhB,iBAAkBkE,SACrB7C,EAAgB,EAChB7B,EAAU2H,gDACTT,EAASU,EAAe,GAAGC,OAE5B7H,EAAU8H,qBAAe1B,GACxBA,EAAE2B,kBAEH/H,EAAUgI,8CACT,GAAK9G,EAAL,CAGAwB,IAAMuF,EAAQL,EAAe,GAAGC,MAAQX,EAExCe,GAAS,IAAMzF,EAAc,GAE7ByF,EAAQ,IAAMzF,GAAe,MAK/BtC,EAAeqD,SAASrB,GAAU,QAGlC/B,EAAeoD,SAASrB,GAAU,UACrBwF,GAAK,SAClBvH,EAAa+H,aAAa,cAAe,GACzC/H,EAAagI,SAAW,EACxBhI,EAAa0C,KAAO,GAGpBzC,EAAemD,SAASrB,GAAU,UACrBwF,GAAK,SAClBtH,EAAa+H,SAAW,EACxB/H,EAAayC,KAAO,GAGpBjB,EAAiB2B,SAASrB,GAAU,SACrBwF,GAAK,YAGpB7G,EAAU0C,SAASrB,GAAU,QACrBwF,GAAK,cACb1G,EAAoBmG,EAAkB,UACpBI,QAAUlD,EAAcX,KAAK,KAAM,GACrD7C,EAAQoB,GAAUjB,GAClBF,EAAcyC,SAASrB,GAAU,QACjCrB,EAAQoB,GAAUnB,GAClBd,EAAUiC,GAAUpB,GAGpBW,EAAgB6F,EAAkB,EAAG,wBACrC5F,EAAe4F,GAAmB,EAAG,sBAGrCzG,EAAc2C,SAASrB,GAAU,QACrBwF,GAAK,YACjB9G,EAAYwD,UACX,sOAED/D,EAAkBkD,SAASrB,GAAU,QACrBwF,GAAK,SAGrBpH,EAAgBiD,SAASrB,GAAU,WACrBgG,aAAa,kBAAmB,GAC9C5H,EAAc8H,MAAQ,uBACtB9H,EAAcuD,yBAAexD,EAAgB8B,GAAUvB,IACvDkC,EACCxC,EACA,kEAEDD,EAAgB4B,GAAU3B,GAG1BJ,EAAa2D,OAAS2B,EACtBtF,EAAa4D,QAAU0B,EAAK9B,KAAK,KAAM,SAEvCgB,OAAOlB,iBAAiB,oBAEvBtC,GAAgBR,GAAagF,EAAkB,GAE/CzF,IAAmBI,GAAmBiE,MAIvCf,SAASC,iBAAiB,oCACb,KAAZ6E,GAAkBpH,GAAUkF,IACxBjF,IACS,KAAZmH,GAAkB7F,EAAc,GACpB,KAAZ6F,GAAkB7F,GAAe,GACrB,KAAZ6F,GAAkB7F,EAAc,IACpB,KAAZ6F,GAAkB7F,GAAe,OAInCe,SAASC,iBAAiB,mBAAY4C,GAEjClF,IADa,CAAC,GAAI,GAAI,GAAI,IACDoE,QAAQc,EAAEiC,UACtCjC,EAAE2B,mBAKJxE,SAASC,iBACR,iBACC4C,GACInF,IAAWjB,EAAUsI,SAASlC,EAAEC,UACnCD,EAAEoB,kBACFhH,EAAY+H,UAGd,GAIDxI,EAAc,EAvOCyI,GAGX9H,IACH8F,aAAa7F,GACbsF,KAGDnE,EAAOkF,EAGPvG,EAAYuG,EAAQyB,OAASzB,EAAQ0B,SAGrCrH,EAAiB2F,EAAQ3F,eACzBC,EAAe0F,EAAQ1F,aACvBC,EAAgByF,EAAQzF,cAMxBH,EAAc,EAGdL,GANAjB,EAAKkH,EAAQlH,IAMO6I,aAAa,gBAE7B3B,EAAQ4B,QAwOb,SAAqBA,EAASxF,GAC7BvD,IAAIgJ,EAAmB/G,EAAK+G,kBAAoB,UAChD,GAAIC,MAAMC,QAAQH,GAGjBjH,EAAaiH,EACb7H,EAAiB6H,EAFjBlH,EAAkB0B,GAAY,GAEYvC,YACpC,CAQN6B,IAAMsG,GANNrH,EAAa,GAAGsH,MAAMC,KACF,iBAAZN,EACJrF,SAASqD,iBAAoBgC,OAAYC,OACzCD,IAGuBtD,QAAQxF,GACnC4B,EACc,IAAb0B,GAAkBA,EAAWA,GAAwB,IAAb4F,EAAiBA,EAAU,EAEpErH,EAAaA,EAAWwH,aAAKrJ,aAC5BA,EACAuD,IAAKvD,EAAG6I,aAAaE,GACrBhI,QAASf,EAAG6I,aAAa,mBAI3BvH,EAAc,IAGZW,EAASuD,QADX/E,EAASoB,EAAWD,GAAiB2B,MACPqC,EAAkB,GAC5C/D,EAAWiB,OAAS,GAEvB5C,EAAUiC,GAAUL,GACpBA,EAAewC,UAAe1C,EAAkB,MAAKC,SAChDE,IAEJ7B,EAAUiC,GAAUT,GACpBxB,EAAUiC,GAAUR,KAIrBE,EAAa,GAEd1B,EAAiBC,GAEFmD,IAAM9C,EApRpB6I,CAAYpC,EAAQ4B,QAAS5B,EAAQ5D,UAC3B3C,GAAauG,EAAQqC,WAG/BpJ,EAAiBI,EAmYdyB,EAAK2G,MACR3C,EAASwD,uBACRxH,EAAKyH,WAAa,YAAc,kBACnB9I,4CACJqB,EAAK4G,SACf5C,EAASwD,kCAAgC7I,gBAC/BqB,EAAKuH,YACfvD,EAAMhE,EAAKuH,WAIZvG,EAAUlC,EAAa,IACvBP,EAAgB4B,GAAUrB,GAG1BN,EAAc+C,IAAMyC,EAEpBxB,IAEAvB,WAAWyC,EAAM,IApZNwB,EAAQzG,QAElBa,EAAc,IAEZW,EAASuD,QADX/E,EAASyG,EAAQzG,SACamF,EAAkB,IAChDzF,EAAiBC,GACFmD,IAAM9C,GACXyG,EAAQwC,OAElB9D,EAAkB,IAClBzF,EAAiBG,GACFiD,IAAM2D,EAAQwC,MAC7BpE,EAAW,eACD4B,EAAQyC,QAElB/D,EAAkB,GACdsB,EAAQlC,YACXhC,EAAU3C,WAAuB6G,EAAQlC,WAAW,SAiMnCmC,EA/LPD,EAAQyC,OAgMhBX,MAAMC,QAAQ9B,IACjBhH,EAAiBE,EAAauJ,YAC9BzC,EAAO9D,iBAASE,GACfX,IAAMuE,EAAS1D,SAASrB,GAAU,UAClC+E,EAAO5D,IAAMA,EACb4D,EAAO0C,KAAO,SAAStG,EAAIuG,MAAM,WAAW,GAC5C3J,EAAegC,GAAUgF,OAG1BhH,EAAiBE,GACFkD,IAAM4D,EAzMrB7B,EAAW,WAGXnF,EAAiBC,GAEFmD,IACC,QAAfvD,EAAG+J,QACA/J,EAAGuD,IACHqB,OACCoF,iBAAiBhK,GACjBiK,gBAAgBC,QAAQ,kBAAmB,IAIjDhK,EAAUiC,GAAUhC,GACpBsD,SAASmD,KAAKzE,GAAUjC,GACjB,OACNmG,EACA8D,uBAAYzH,EAAc,IAC1B0H,uBAAY1H,GAAe,KAoV7B,IACKsD"}